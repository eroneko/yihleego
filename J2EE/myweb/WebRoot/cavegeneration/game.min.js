(function(a){Number.prototype.map=function(a,b,c,d){return c+(this-a)/(b-a)*(d-c)};Number.prototype.limit=function(a,b){return Math.min(b,Math.max(a,this))};Number.prototype.round=function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a};Number.prototype.floor=function(){return Math.floor(this)};Number.prototype.ceil=function(){return Math.ceil(this)};Number.prototype.toInt=function(){return this|0};Number.prototype.toRad=function(){return this/180*Math.PI};Number.prototype.toDeg=function(){return 180*
this/Math.PI};Array.prototype.erase=function(a){for(var b=this.length;b--;)this[b]===a&&this.splice(b,1);return this};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]};Function.prototype.bind=Function.prototype.bind||function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?
this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e};a.ig={game:null,debug:null,version:"1.21",global:a,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:a.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(a){return"#"==a.charAt(0)?document.getElementById(a.substr(1)):document.getElementsByTagName(a)},$new:function(a){return document.createElement(a)},copy:function(a){if(!a||"object"!=typeof a||
a instanceof HTMLElement||a instanceof ig.Class)return a;if(a instanceof Array)for(var b=[],c=0,d=a.length;c<d;c++)b[c]=ig.copy(a[c]);else for(c in b={},a)b[c]=ig.copy(a[c]);return b},merge:function(a,b){for(var c in b){var d=b[c];"object"!=typeof d||d instanceof HTMLElement||d instanceof ig.Class?a[c]=d:(a[c]&&"object"==typeof a[c]||(a[c]=d instanceof Array?[]:{}),ig.merge(a[c],d))}return a},ksort:function(a){if(!a||"object"!=typeof a)return[];var b=[],c=[],d;for(d in a)b.push(d);b.sort();for(d=
0;d<b.length;d++)c.push(a[b[d]]);return c},setVendorAttribute:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.substr(1);a[b]=a["ms"+d]=a["moz"+d]=a["webkit"+d]=a["o"+d]=c},getVendorAttribute:function(a,b){var c=b.charAt(0).toUpperCase()+b.substr(1);return a[b]||a["ms"+c]||a["moz"+c]||a["webkit"+c]||a["o"+c]},normalizeVendorAttribute:function(a,b){var c=ig.getVendorAttribute(a,b);!a[b]&&c&&(a[b]=c)},getImagePixels:function(a,b,c,d,e){var f=ig.$new("canvas");f.width=a.width;f.height=a.height;var l=
f.getContext("2d"),q=ig.getVendorAttribute(l,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(l,"getImageDataHD");var u=a.width/q,r=a.height/q;f.width=Math.ceil(u);f.height=Math.ceil(r);l.drawImage(a,0,0,u,r);return 1===q?l.getImageData(b,c,d,e):l.getImageDataHD(b,c,d,e)},module:function(a){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[a]&&ig.modules[a].body)throw"Module '"+a+"' is already defined";ig._current={name:a,requires:[],loaded:!1,body:null};ig.modules[a]=
ig._current;ig._loadQueue.push(ig._current);return ig},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig},defines:function(a){ig._current.body=a;ig._current=null;ig._initDOMReady()},addResource:function(a){ig.resources.push(a)},setNocache:function(a){ig.nocache=a?"?"+Date.now():""},log:function(){},assert:function(a,b){},show:function(a,b){},mark:function(a,b){},_loadScript:function(a,b){ig.modules[a]={name:a,requires:[],loaded:!1,body:null};ig._waitForOnload++;
var c=ig.prefix+ig.lib+a.replace(/\./g,"/")+".js"+ig.nocache,d=ig.$new("script");d.type="text/javascript";d.src=c;d.onload=function(){ig._waitForOnload--;ig._execModules()};d.onerror=function(){throw"Failed to load module "+a+" at "+c+" required from "+b;};ig.$("head")[0].appendChild(d)},_execModules:function(){for(var a=!1,b=0;b<ig._loadQueue.length;b++){for(var c=ig._loadQueue[b],d=!0,e=0;e<c.requires.length;e++){var f=c.requires[e];ig.modules[f]?ig.modules[f].loaded||(d=!1):(d=!1,ig._loadScript(f,
c.name))}d&&c.body&&(ig._loadQueue.splice(b,1),c.loaded=!0,c.body(),a=!0,b--)}if(a)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){a=[];for(b=0;b<ig._loadQueue.length;b++){d=[];f=ig._loadQueue[b].requires;for(e=0;e<f.length;e++)(c=ig.modules[f[e]])&&c.loaded||d.push(f[e]);a.push(ig._loadQueue[b].name+" (requires: "+d.join(", ")+")")}throw"Unresolved (circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules:\n"+a.join("\n");
}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0;ig._waitForOnload--;ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0);ig.ua.pixelRatio=a.devicePixelRatio||1;ig.ua.viewport={width:a.innerWidth,height:a.innerHeight};ig.ua.screen={width:a.screen.availWidth*ig.ua.pixelRatio,height:a.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);
ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio;ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android},_initDOMReady:function(){ig.modules["dom.ready"]?ig._execModules():(ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,"complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),a.addEventListener("load",
ig._DOMReady,!1)))}};ig.normalizeVendorAttribute(a,"requestAnimationFrame");if(a.requestAnimationFrame){var b=1,c={};a.ig.setAnimation=function(d,e){var f=b++;c[f]=!0;var h=function(){c[f]&&(a.requestAnimationFrame(h,e),d())};a.requestAnimationFrame(h,e);return f};a.ig.clearAnimation=function(a){delete c[a]}}else a.ig.setAnimation=function(b,c){return a.setInterval(b,1E3/60)},a.ig.clearAnimation=function(b){a.clearInterval(b)};var d=!1,e=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;a.ig.Class=function(){};
var f=function(a){var b=this.prototype,c={},d;for(d in a)"function"==typeof a[d]&&"function"==typeof b[d]&&e.test(a[d])?(c[d]=b[d],b[d]=function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);this.parent=d;return e}}(d,a[d])):b[d]=a[d]};a.ig.Class.extend=function(b){function c(){if(!d){if(this.staticInstantiate){var a=this.staticInstantiate.apply(this,arguments);if(a)return a}for(var b in this)"object"==typeof this[b]&&(this[b]=ig.copy(this[b]));this.init&&
this.init.apply(this,arguments)}return this}var k=this.prototype;d=!0;var h=new this;d=!1;for(var m in b)"function"==typeof b[m]&&"function"==typeof k[m]&&e.test(b[m])?h[m]=function(a,b){return function(){var c=this.parent;this.parent=k[a];var d=b.apply(this,arguments);this.parent=c;return d}}(m,b[m]):h[m]=b[m];c.prototype=h;c.prototype.constructor=c;c.extend=a.ig.Class.extend;c.inject=f;return c}})(window);ig.baked=!0;
ig.module("impact.image").defines(function(){ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(a){return ig.Image.cache[a]||null},init:function(a){this.path=a;this.load()},load:function(a){this.loaded?a&&a(this.path,!0):(!this.loaded&&ig.ready?(this.loadCallback=a||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),
ig.Image.cache[this.path]=this)},reload:function(){this.loaded=!1;this.data=new Image;this.data.onload=this.onload.bind(this);this.data.src=this.path+"?"+Date.now()},onload:function(a){this.width=this.data.width;this.height=this.data.height;this.loaded=!0;1!=ig.system.scale&&this.resize(ig.system.scale);this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(a){this.failed=!0;this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(a){var b=ig.getImagePixels(this.data,0,0,
this.width,this.height),c=this.width*a,d=this.height*a,e=ig.$new("canvas");e.width=c;e.height=d;for(var f=e.getContext("2d"),g=f.getImageData(0,0,c,d),n=0;n<d;n++)for(var k=0;k<c;k++){var h=4*(Math.floor(n/a)*this.width+Math.floor(k/a)),m=4*(n*c+k);g.data[m]=b.data[h];g.data[m+1]=b.data[h+1];g.data[m+2]=b.data[h+2];g.data[m+3]=b.data[h+3]}f.putImageData(g,0,0);this.data=e},draw:function(a,b,c,d,e,f){if(this.loaded){var g=ig.system.scale;e=(e?e:this.width)*g;f=(f?f:this.height)*g;ig.system.context.drawImage(this.data,
c?c*g:0,d?d*g:0,e,f,ig.system.getDrawPos(a),ig.system.getDrawPos(b),e,f);ig.Image.drawCount++}},drawTile:function(a,b,c,d,e,f,g){e=e?e:d;if(!(!this.loaded||d>this.width||e>this.height)){var n=ig.system.scale,k=Math.floor(d*n),h=Math.floor(e*n),m=f?-1:1,p=g?-1:1;if(f||g)ig.system.context.save(),ig.system.context.scale(m,p);ig.system.context.drawImage(this.data,Math.floor(c*d)%this.width*n,Math.floor(c*d/this.width)*e*n,k,h,ig.system.getDrawPos(a)*m-(f?k:0),ig.system.getDrawPos(b)*p-(g?h:0),k,h);(f||
g)&&ig.system.context.restore();ig.Image.drawCount++}}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var a in ig.Image.cache)ig.Image.cache[a].reload()}});ig.baked=!0;
ig.module("impact.font").requires("impact.image").defines(function(){ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(a){this._loadMetrics(this.data);this.parent(a)},widthForString:function(a){if(-1!==a.indexOf("\n")){a=a.split("\n");for(var b=0,c=0;c<a.length;c++)b=Math.max(b,this._widthForLine(a[c]));return b}return this._widthForLine(a)},_widthForLine:function(a){for(var b=0,c=0;c<a.length;c++)b+=this.widthMap[a.charCodeAt(c)-this.firstChar]+
this.letterSpacing;return b},heightForString:function(a){return a.split("\n").length*(this.height+this.lineSpacing)},draw:function(a,b,c,d){"string"!=typeof a&&(a=a.toString());if(-1!==a.indexOf("\n")){a=a.split("\n");for(var e=this.height+this.lineSpacing,f=0;f<a.length;f++)this.draw(a[f],b,c+f*e,d)}else{if(d==ig.Font.ALIGN.RIGHT||d==ig.Font.ALIGN.CENTER)f=this._widthForLine(a),b-=d==ig.Font.ALIGN.CENTER?f/2:f;1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(f=0;f<a.length;f++)d=a.charCodeAt(f),
b+=this._drawChar(d-this.firstChar,b,c);1!==this.alpha&&(ig.system.context.globalAlpha=1);ig.Image.drawCount+=a.length}},_drawChar:function(a,b,c){if(!this.loaded||0>a||a>=this.indices.length)return 0;var d=ig.system.scale,e=this.widthMap[a]*d,f=(this.height-2)*d;ig.system.context.drawImage(this.data,this.indices[a]*d,0,e,f,ig.system.getDrawPos(b),ig.system.getDrawPos(c),e,f);return this.widthMap[a]+this.letterSpacing},_loadMetrics:function(a){this.height=a.height-1;this.widthMap=[];this.indices=
[];for(var b=ig.getImagePixels(a,0,a.height-1,a.width,1),c=0,d=0,e=0;e<a.width;e++){var f=4*e+3;127<b.data[f]?d++:0==b.data[f]&&d&&(this.widthMap.push(d),this.indices.push(e-d),c++,d=0)}this.widthMap.push(d);this.indices.push(e-d)}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}});ig.baked=!0;
ig.module("impact.sound").defines(function(){ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(ig.Sound.enabled&&window.Audio){for(var a=new Audio,b=0;b<ig.Sound.use.length;b++){var c=ig.Sound.use[b];if(a.canPlayType(c.mime)){this.format=c;break}}this.format||(ig.Sound.enabled=!1)}else ig.Sound.enabled=!1},load:function(a,b,c){var d=ig.prefix+a.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[a]){if(b&&this.clips[a].length<ig.Sound.channels)for(b=this.clips[a].length;b<
ig.Sound.channels;b++){var e=new Audio(d);e.load();this.clips[a].push(e)}return this.clips[a][0]}var f=new Audio(d);c&&(f.addEventListener("canplaythrough",function n(b){f.removeEventListener("canplaythrough",n,!1);c(a,!0,b)},!1),f.addEventListener("error",function(b){c(a,!1,b)},!1));f.preload="auto";f.load();this.clips[a]=[f];if(b)for(b=1;b<ig.Sound.channels;b++)e=new Audio(d),e.load(),this.clips[a].push(e);return f},get:function(a){a=this.clips[a];for(var b=0,c;c=a[b++];)if(c.paused||c.ended)return c.ended&&
(c.currentTime=0),c;a[0].pause();a[0].currentTime=0;return a[0]}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):
this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)))},add:function(a,b){if(ig.Sound.enabled){var c=ig.soundManager.load(a instanceof ig.Sound?a.path:a,!1);c.loop=this._loop;c.volume=this._volume;c.addEventListener("ended",this._endedCallbackBound,!1);this.tracks.push(c);b&&(this.namedTracks[b]=c);this.currentTrack||
(this.currentTrack=c)}},next:function(){this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play())},pause:function(){this.currentTrack&&this.currentTrack.pause()},stop:function(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0)},play:function(a){if(a&&this.namedTracks[a])a=this.namedTracks[a],a!=this.currentTrack&&(this.stop(),
this.currentTrack=a);else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(a){this._loop=a;for(var b in this.tracks)this.tracks[b].loop=a},getVolume:function(){return this._volume},setVolume:function(a){this._volume=a.limit(0,1);for(var b in this.tracks)this.tracks[b].volume=this._volume},fadeOut:function(a){this.currentTrack&&(clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(a),this._fadeInterval=setInterval(this._fadeStep.bind(this),
50))},_fadeStep:function(){var a=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;.01>=a?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=a},_endedCallback:function(){this._loop?this.play():this.next()}});ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(a,b){this.path=a;this.multiChannel=!1!==b;this.load()},load:function(a){ig.Sound.enabled?ig.ready?ig.soundManager.load(this.path,
this.multiChannel,a):ig.addResource(this):a&&a(this.path,!0)},play:function(){ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play())},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}});ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},
CAF:{ext:"caf",mime:"audio/x-caf"}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=!0});ig.baked=!0;
ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(a,b){this.gameClass=a;this.resources=b;this._loadCallbackBound=this._loadCallback.bind(this);for(var c=0;c<this.resources.length;c++)this._unloaded.push(this.resources[c].path)},load:function(){ig.system.clear("#000");if(this.resources.length){for(var a=
0;a<this.resources.length;a++)this.loadResource(this.resources[a]);this._intervalId=setInterval(this.draw.bind(this),16)}else this.end()},loadResource:function(a){a.load(this._loadCallbackBound)},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass))},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var a=ig.system.scale,b=.6*ig.system.width,c=.1*ig.system.height,d=.5*ig.system.width-b/2,e=.5*ig.system.height-c/2;ig.system.context.fillStyle=
"#000";ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle="#fff";ig.system.context.fillRect(d*a,e*a,b*a,c*a);ig.system.context.fillStyle="#000";ig.system.context.fillRect(d*a+a,e*a+a,b*a-a-a,c*a-a-a);ig.system.context.fillStyle="#fff";ig.system.context.fillRect(d*a,e*a,b*a*this._drawStatus,c*a)},_loadCallback:function(a,b){if(b)this._unloaded.erase(a);else throw"Failed to load resource: "+a;this.status=1-this._unloaded.length/this.resources.length;0==this._unloaded.length&&setTimeout(this.end.bind(this),
250)}})});ig.baked=!0;
ig.module("impact.timer").defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(a){this.last=this.base=ig.Timer.time;this.target=a||0},set:function(a){this.target=a||0;this.base=ig.Timer.time;this.pausedAt=0},reset:function(){this.base=ig.Timer.time;this.pausedAt=0},tick:function(){var a=ig.Timer.time-this.last;this.last=ig.Timer.time;return this.pausedAt?0:a},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||
(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=.05;ig.Timer.step=function(){var a=Date.now();ig.Timer.time+=Math.min((a-ig.Timer._last)/1E3,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=a}});ig.baked=!0;
ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(a,b,c,d,e){this.fps=b;this.clock=new ig.Timer;this.canvas=ig.$(a);this.resize(c,d,e);this.context=this.canvas.getContext("2d");this.getDrawPos=ig.System.drawMode;1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP);
ig.System.scaleMode(this.canvas,this.context)},resize:function(a,b,c){this.width=a;this.height=b;this.scale=c||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight},setGame:function(a){this.running?this.newGameClass=a:this.setGameNow(a)},setGameNow:function(a){ig.game=new a;ig.system.setDelegate(ig.game)},setDelegate:function(a){if("function"==typeof a.run)this.delegate=a,this.startRunLoop();else throw"System.setDelegate: No run() function in object";
},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=!1},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=!0},clear:function(a){this.context.fillStyle=a;this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null});
ig.System.DRAW={AUTHENTIC:function(a){return Math.round(a)*this.scale},SMOOTH:function(a){return Math.round(a*this.scale)},SUBPIXEL:function(a){return a*this.scale}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(a,b){ig.setVendorAttribute(b,"imageSmoothingEnabled",!1);a.style.imageRendering="-moz-crisp-edges";a.style.imageRendering="-o-crisp-edges";a.style.imageRendering="-webkit-optimize-contrast";a.style.imageRendering="crisp-edges";a.style.msInterpolationMode="nearest-neighbor"},
SMOOTH:function(a,b){ig.setVendorAttribute(b,"imageSmoothingEnabled",!0);a.style.imageRendering="";a.style.msInterpolationMode=""}};ig.System.scaleMode=ig.System.SCALE.SMOOTH});ig.baked=!0;
ig.module("impact.input").defines(function(){ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,
NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=
!0;var a=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",a,!1);ig.system.canvas.addEventListener("DOMMouseScroll",a,!1);ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1);ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1);ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1);ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),
!1);ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1);ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1)}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(a){var b=
this.bindings[0<(a.wheelDelta?a.wheelDelta:-1*a.detail)?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN];b&&(this.actions[b]=!0,this.presses[b]=!0,this.delayedKeyup[b]=!0,a.stopPropagation(),a.preventDefault())},mousemove:function(a){var b=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,b=b/ig.system.realWidth*ig.system.scale,c={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(c=ig.system.canvas.getBoundingClientRect());a=a.touches?a.touches[0]:a;this.mouse.x=(a.clientX-c.left)/b;this.mouse.y=
(a.clientY-c.top)/b},contextmenu:function(a){this.bindings[ig.KEY.MOUSE2]&&(a.stopPropagation(),a.preventDefault())},keydown:function(a){var b=a.target.tagName;"INPUT"!=b&&"TEXTAREA"!=b&&(b="keydown"==a.type?a.keyCode:2==a.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,"touchstart"!=a.type&&"mousedown"!=a.type||this.mousemove(a),b=this.bindings[b])&&(this.actions[b]=!0,this.locks[b]||(this.presses[b]=!0,this.locks[b]=!0),a.stopPropagation(),a.preventDefault())},keyup:function(a){var b=a.target.tagName;"INPUT"!=
b&&"TEXTAREA"!=b&&(b=this.bindings["keyup"==a.type?a.keyCode:2==a.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1])&&(this.delayedKeyup[b]=!0,a.stopPropagation(),a.preventDefault())},devicemotion:function(a){this.accel=a.accelerationIncludingGravity},bind:function(a,b){0>a?this.initMouse():0<a&&this.initKeyboard();this.bindings[a]=b},bindTouch:function(a,b){var c=ig.$(a),d=this;c.addEventListener("touchstart",function(a){d.touchStart(a,b)},!1);c.addEventListener("touchend",function(a){d.touchEnd(a,b)},!1)},unbind:function(a){this.delayedKeyup[this.bindings[a]]=
!0;this.bindings[a]=null},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={}},state:function(a){return this.actions[a]},pressed:function(a){return this.presses[a]},released:function(a){return this.delayedKeyup[a]},clearPressed:function(){for(var a in this.delayedKeyup)this.actions[a]=!1,this.locks[a]=!1;this.delayedKeyup={};this.presses={}},touchStart:function(a,b){this.actions[b]=!0;this.presses[b]=!0;a.stopPropagation();a.preventDefault();return!1},
touchEnd:function(a,b){this.delayedKeyup[b]=!0;a.stopPropagation();a.preventDefault();return!1}})});ig.baked=!0;ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){ig.main=function(a,b,c,d,e,f,g){ig.system=new ig.System(a,c,d,e,f||1);ig.input=new ig.Input;ig.soundManager=new ig.SoundManager;ig.music=new ig.Music;ig.ready=!0;(new (g||ig.Loader)(b,ig.resources)).load()}});ig.baked=!0;
ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(a,b,c){this.width=b;this.height=c;this.image=new ig.Image(a)}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(a,b,c,d){this.sheet=a;this.pivot={x:a.width/2,y:a.height/2};this.timer=new ig.Timer;this.frameTime=b;this.sequence=c;
this.stop=!!d;this.tile=this.sequence[0]},rewind:function(){this.timer.set();this.loopCount=0;this.tile=this.sequence[0];return this},gotoFrame:function(a){this.timer.set(this.frameTime*-a);this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var a=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(a/this.sequence.length);this.frame=this.stop&&0<this.loopCount?this.sequence.length-1:a%this.sequence.length;
this.tile=this.sequence[this.frame]},draw:function(a,b){var c=Math.max(this.sheet.width,this.sheet.height);a>ig.system.width||b>ig.system.height||0>a+c||0>b+c||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(a,b,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(a+this.pivot.x),ig.system.getDrawPos(b+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,
-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})});ig.baked=!0;
ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(a,
b,c){this.id=++ig.Entity._lastId;this.pos.x=a;this.pos.y=b;ig.merge(this,c)},addAnim:function(a,b,c,d){if(!this.animSheet)throw"No animSheet to add the animation "+a+" to.";b=new ig.Animation(this.animSheet,b,c,d);this.anims[a]=b;this.currentAnim||(this.currentAnim=b);return b},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=
this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var a=ig.game.collisionMap.trace(this.pos.x,this.pos.y,this.vel.x*ig.system.tick,this.vel.y*ig.system.tick,this.size.x,this.size.y);this.handleMovementTrace(a);this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(a,b,c,d){return b?(a+b*ig.system.tick).limit(-d,d):c?(b=c*ig.system.tick,0<a-b?a-b:0>a+b?a+b:0):a.limit(-d,d)},handleMovementTrace:function(a){this.standing=!1;a.collision.y&&(0<this.bounciness&&Math.abs(this.vel.y)>
this.minBounceVelocity?this.vel.y*=-this.bounciness:(0<this.vel.y&&(this.standing=!0),this.vel.y=0));a.collision.x&&(0<this.bounciness&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0);if(a.collision.slope){var b=a.collision.slope;if(0<this.bounciness){var c=this.vel.x*b.nx+this.vel.y*b.ny;this.vel.x=(this.vel.x-b.nx*c*2)*this.bounciness;this.vel.y=(this.vel.y-b.ny*c*2)*this.bounciness}else c=(this.vel.x*b.x+this.vel.y*b.y)/(b.x*b.x+b.y*b.y),this.vel.x=b.x*c,
this.vel.y=b.y*c,b=Math.atan2(b.x,b.y),b>this.slopeStanding.min&&b<this.slopeStanding.max&&(this.standing=!0)}this.pos=a.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(a,b){this.health-=a;0>=this.health&&this.kill()},touches:function(a){return!(this.pos.x>=a.pos.x+a.size.x||this.pos.x+this.size.x<=a.pos.x||this.pos.y>=a.pos.y+a.size.y||
this.pos.y+this.size.y<=a.pos.y)},distanceTo:function(a){var b=this.pos.x+this.size.x/2-(a.pos.x+a.size.x/2);a=this.pos.y+this.size.y/2-(a.pos.y+a.size.y/2);return Math.sqrt(b*b+a*a)},angleTo:function(a){return Math.atan2(a.pos.y+a.size.y/2-(this.pos.y+this.size.y/2),a.pos.x+a.size.x/2-(this.pos.x+this.size.x/2))},check:function(a){},collideWith:function(a,b){},ready:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};
ig.Entity.checkPair=function(a,b){a.checkAgainst&b.type&&a.check(b);b.checkAgainst&a.type&&b.check(a);a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(a,b)};ig.Entity.solveCollision=function(a,b){var c=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED)c=a;else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED)c=b;a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x?(a.last.y<b.last.y?ig.Entity.seperateOnYAxis(a,
b,c):ig.Entity.seperateOnYAxis(b,a,c),a.collideWith(b,"y"),b.collideWith(a,"y")):a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y&&(a.last.x<b.last.x?ig.Entity.seperateOnXAxis(a,b,c):ig.Entity.seperateOnXAxis(b,a,c),a.collideWith(b,"x"),b.collideWith(a,"x"))};ig.Entity.seperateOnXAxis=function(a,b,c){var d=a.pos.x+a.size.x-b.pos.x;c?(c.vel.x=-c.vel.x*c.bounciness+(a===c?b:a).vel.x,b=ig.game.collisionMap.trace(c.pos.x,c.pos.y,c==a?-d:d,0,c.size.x,c.size.y),c.pos.x=b.pos.x):(c=(a.vel.x-b.vel.x)/
2,a.vel.x=-c,b.vel.x=c,c=ig.game.collisionMap.trace(a.pos.x,a.pos.y,-d/2,0,a.size.x,a.size.y),a.pos.x=Math.floor(c.pos.x),a=ig.game.collisionMap.trace(b.pos.x,b.pos.y,d/2,0,b.size.x,b.size.y),b.pos.x=Math.ceil(a.pos.x))};ig.Entity.seperateOnYAxis=function(a,b,c){var d=a.pos.y+a.size.y-b.pos.y;if(c){b=a===c?b:a;c.vel.y=-c.vel.y*c.bounciness+b.vel.y;var e=0;c==a&&Math.abs(c.vel.y-b.vel.y)<c.minBounceVelocity&&(c.standing=!0,e=b.vel.x*ig.system.tick);a=ig.game.collisionMap.trace(c.pos.x,c.pos.y,e,c==
a?-d:d,c.size.x,c.size.y);c.pos.y=a.pos.y;c.pos.x=a.pos.x}else ig.game.gravity&&(b.standing||0<a.vel.y)?(c=ig.game.collisionMap.trace(a.pos.x,a.pos.y,0,-(a.pos.y+a.size.y-b.pos.y),a.size.x,a.size.y),a.pos.y=c.pos.y,0<a.bounciness&&a.vel.y>a.minBounceVelocity?a.vel.y*=-a.bounciness:(a.standing=!0,a.vel.y=0)):(c=(a.vel.y-b.vel.y)/2,a.vel.y=-c,b.vel.y=c,e=b.vel.x*ig.system.tick,c=ig.game.collisionMap.trace(a.pos.x,a.pos.y,e,-d/2,a.size.x,a.size.y),a.pos.y=c.pos.y,a=ig.game.collisionMap.trace(b.pos.x,
b.pos.y,0,d/2,b.size.x,b.size.y),b.pos.y=a.pos.y)}});ig.baked=!0;
ig.module("impact.map").defines(function(){ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(a,b){this.tilesize=a;this.data=b;this.height=b.length;this.width=b[0].length},getTile:function(a,b){var c=Math.floor(a/this.tilesize),d=Math.floor(b/this.tilesize);return 0<=c&&c<this.width&&0<=d&&d<this.height?this.data[d][c]:0},setTile:function(a,b,c){a=Math.floor(a/this.tilesize);b=Math.floor(b/this.tilesize);0<=a&&a<this.width&&0<=b&&b<this.height&&(this.data[b][a]=
c)}})});ig.baked=!0;
ig.module("impact.collision-map").requires("impact.map").defines(function(){ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(a,b,e){this.parent(a,b);this.tiledef=e||ig.CollisionMap.defaultTileDef;for(var f in this.tiledef)f|0>this.lastSlope&&(this.lastSlope=f|0)},trace:function(a,b,e,f,g,n){var k={collision:{x:!1,y:!1,slope:!1},pos:{x:a,y:b},tile:{x:0,y:0}},h=Math.ceil(Math.max(Math.abs(e),Math.abs(f))/this.tilesize);if(1<h)for(var m=e/h,p=f/h,l=0;l<h&&(m||p)&&(this._traceStep(k,
a,b,m,p,g,n,e,f,l),a=k.pos.x,b=k.pos.y,k.collision.x&&(e=m=0),k.collision.y&&(f=p=0),!k.collision.slope);l++);else this._traceStep(k,a,b,e,f,g,n,e,f,0);return k},_traceStep:function(a,b,e,f,g,n,k,h,m,p){a.pos.x+=f;a.pos.y+=g;var l=0;if(f){var q=0<f?n:0,u=0>f?this.tilesize:0,l=Math.max(Math.floor(e/this.tilesize),0),r=Math.min(Math.ceil((e+k)/this.tilesize),this.height);f=Math.floor((a.pos.x+q)/this.tilesize);var v=Math.floor((b+q)/this.tilesize);if(0<p||f==v||0>v||v>=this.width)v=-1;if(0<=f&&f<this.width)for(var t=
l;t<r&&!(-1!=v&&(l=this.data[t][v],1<l&&l<=this.lastSlope&&this._checkTileDef(a,l,b,e,h,m,n,k,v,t)));t++)if(l=this.data[t][f],1==l||l>this.lastSlope||1<l&&this._checkTileDef(a,l,b,e,h,m,n,k,f,t)){if(1<l&&l<=this.lastSlope&&a.collision.slope)break;a.collision.x=!0;a.tile.x=l;b=a.pos.x=f*this.tilesize-q+u;h=0;break}}if(g){q=0<g?k:0;g=0>g?this.tilesize:0;l=Math.max(Math.floor(a.pos.x/this.tilesize),0);u=Math.min(Math.ceil((a.pos.x+n)/this.tilesize),this.width);t=Math.floor((a.pos.y+q)/this.tilesize);
r=Math.floor((e+q)/this.tilesize);if(0<p||t==r||0>r||r>=this.height)r=-1;if(0<=t&&t<this.height)for(f=l;f<u&&!(-1!=r&&(l=this.data[r][f],1<l&&l<=this.lastSlope&&this._checkTileDef(a,l,b,e,h,m,n,k,f,r)));f++)if(l=this.data[t][f],1==l||l>this.lastSlope||1<l&&this._checkTileDef(a,l,b,e,h,m,n,k,f,t)){if(1<l&&l<=this.lastSlope&&a.collision.slope)break;a.collision.y=!0;a.tile.y=l;a.pos.y=t*this.tilesize-q+g;break}}},_checkTileDef:function(a,b,e,f,g,n,k,h,m,p){var l=this.tiledef[b];if(!l)return!1;b=(l[2]-
l[0])*this.tilesize;var q=(l[3]-l[1])*this.tilesize,u=l[4];k=e+g+(0>q?k:0)-(m+l[0])*this.tilesize;h=f+n+(0<b?h:0)-(p+l[1])*this.tilesize;if(0<b*h-q*k){if(0>g*-q+n*b)return u;m=Math.sqrt(b*b+q*q);p=q/m;m=-b/m;var r=k*p+h*m,l=p*r,r=m*r;if(l*l+r*r>=g*g+n*n)return u||.5>b*(h-n)-q*(k-g);a.pos.x=e+g-l;a.pos.y=f+n-r;a.collision.slope={x:b,y:q,nx:p,ny:m};return!0}return!1}});var a=1/3,b=2/3;ig.CollisionMap.defaultTileDef={5:[0,1,1,b,!0],6:[0,b,1,a,!0],7:[0,a,1,0,!0],3:[0,1,1,.5,!0],4:[0,.5,1,0,!0],2:[0,1,
1,0,!0],10:[.5,1,1,0,!0],21:[0,1,.5,0,!0],32:[b,1,1,0,!0],43:[a,1,b,0,!0],54:[0,1,a,0,!0],27:[0,0,1,a,!0],28:[0,a,1,b,!0],29:[0,b,1,1,!0],25:[0,0,1,.5,!0],26:[0,.5,1,1,!0],24:[0,0,1,1,!0],11:[0,0,.5,1,!0],22:[.5,0,1,1,!0],33:[0,0,a,1,!0],44:[a,0,b,1,!0],55:[b,0,1,1,!0],16:[1,a,0,0,!0],17:[1,b,0,a,!0],18:[1,1,0,b,!0],14:[1,.5,0,0,!0],15:[1,1,0,.5,!0],13:[1,1,0,0,!0],8:[.5,1,0,0,!0],19:[1,1,.5,0,!0],30:[a,1,0,0,!0],41:[b,1,a,0,!0],52:[1,1,b,0,!0],38:[1,b,0,1,!0],39:[1,a,0,b,!0],40:[1,0,0,a,!0],36:[1,
.5,0,1,!0],37:[1,0,0,.5,!0],35:[1,0,0,1,!0],9:[1,0,.5,1,!0],20:[.5,0,0,1,!0],31:[1,0,b,1,!0],42:[b,0,a,1,!0],53:[a,0,0,1,!0],12:[0,0,1,0,!1],23:[1,1,0,1,!1],34:[1,0,1,1,!1],45:[0,1,0,0,!1]};ig.CollisionMap.staticNoCollision={trace:function(a,b,e,f){return{collision:{x:!1,y:!1,slope:!1},pos:{x:a+e,y:b+f},tile:{x:0,y:0}}}}});ig.baked=!0;
ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(a,b,c){this.parent(a,b);this.setTileset(c)},setTileset:function(a){this.tilesetName=a instanceof ig.Image?a.path:a;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null},setScreenPos:function(a,
b){this.scroll.x=a/this.distance;this.scroll.y=b/this.distance},preRenderMapToChunks:function(){var a=this.width*this.tilesize*ig.system.scale,b=this.height*this.tilesize*ig.system.scale,c=Math.ceil(a/this.chunkSize),d=Math.ceil(b/this.chunkSize);this.preRenderedChunks=[];for(var e=0;e<d;e++){this.preRenderedChunks[e]=[];for(var f=0;f<c;f++)this.preRenderedChunks[e][f]=this.preRenderChunk(f,e,f==c-1?a-f*this.chunkSize:this.chunkSize,e==d-1?b-e*this.chunkSize:this.chunkSize)}},preRenderChunk:function(a,
b,c,d){var e=c/this.tilesize/ig.system.scale+1,f=d/this.tilesize/ig.system.scale+1,g=a*this.chunkSize/ig.system.scale%this.tilesize,n=b*this.chunkSize/ig.system.scale%this.tilesize;a=Math.floor(a*this.chunkSize/this.tilesize/ig.system.scale);b=Math.floor(b*this.chunkSize/this.tilesize/ig.system.scale);var k=ig.$new("canvas");k.width=c;k.height=d;c=ig.system.context;ig.system.context=k.getContext("2d");for(d=0;d<e;d++)for(var h=0;h<f;h++)if(d+a<this.width&&h+b<this.height){var m=this.data[h+b][d+a];
m&&this.tiles.drawTile(d*this.tilesize-g,h*this.tilesize-n,m-1,this.tilesize)}ig.system.context=c;return k},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled())},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var a=ig.system.getDrawPos(this.scroll.x),b=ig.system.getDrawPos(this.scroll.y);if(this.repeat)var c=this.width*this.tilesize*ig.system.scale,a=(a%c+c)%c,c=this.height*this.tilesize*ig.system.scale,b=(b%c+c)%
c;var c=Math.max(Math.floor(a/this.chunkSize),0),d=Math.max(Math.floor(b/this.chunkSize),0),e=Math.ceil((a+ig.system.realWidth)/this.chunkSize),f=Math.ceil((b+ig.system.realHeight)/this.chunkSize),g=this.preRenderedChunks[0].length,n=this.preRenderedChunks.length;this.repeat||(e=Math.min(e,g),f=Math.min(f,n));for(var k=0;d<f;d++){for(var h=0,m=c;m<e;m++){var p=this.preRenderedChunks[d%n][m%g],l=-a+m*this.chunkSize-h,q=-b+d*this.chunkSize-k;ig.system.context.drawImage(p,l,q);ig.Image.drawCount++;this.debugChunks&&
(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(l,q,this.chunkSize,this.chunkSize));this.repeat&&p.width<this.chunkSize&&l+p.width<ig.system.realWidth&&(h=this.chunkSize-p.width,e++)}this.repeat&&p.height<this.chunkSize&&q+p.height<ig.system.realHeight&&(k=this.chunkSize-p.height,f++)}},drawTiled:function(){for(var a=0,b=null,c=(this.scroll.x/this.tilesize).toInt(),d=(this.scroll.y/this.tilesize).toInt(),e=this.scroll.x%this.tilesize,f=this.scroll.y%this.tilesize,g=-e-this.tilesize,
e=ig.system.width+this.tilesize-e,n=ig.system.height+this.tilesize-f,k=-1,f=-f-this.tilesize;f<n;k++,f+=this.tilesize){var h=k+d;if(h>=this.height||0>h){if(!this.repeat)continue;h=(h%this.height+this.height)%this.height}for(var m=-1,p=g;p<e;m++,p+=this.tilesize){a=m+c;if(a>=this.width||0>a){if(!this.repeat)continue;a=(a%this.width+this.width)%this.width}if(a=this.data[h][a])(b=this.anims[a-1])?b.draw(p,f):this.tiles.drawTile(p,f,a-1,this.tilesize)}}}})});ig.baked=!0;
ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;
ig.game=this;return null},loadLevel:function(a){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var b=0;b<a.entities.length;b++){var c=a.entities[b];this.spawnEntity(c.type,c.x,c.y,c.settings)}this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(b=0;b<a.layer.length;b++)if(c=a.layer[b],"collision"==c.name)this.collisionMap=new ig.CollisionMap(c.tilesize,c.data);else{var d=new ig.BackgroundMap(c.tilesize,c.data,c.tilesetName);d.anims=this.backgroundAnims[c.tilesetName]||
{};d.repeat=c.repeat;d.distance=c.distance;d.foreground=!!c.foreground;d.preRender=!!c.preRender;d.name=c.name;this.backgroundMaps.push(d)}for(b=0;b<this.entities.length;b++)this.entities[b].ready()},loadLevelDeferred:function(a){this._levelToLoad=a},getMapByName:function(a){if("collision"==a)return this.collisionMap;for(var b=0;b<this.backgroundMaps.length;b++)if(this.backgroundMaps[b].name==a)return this.backgroundMaps[b];return null},getEntityByName:function(a){return this.namedEntities[a]},getEntitiesByType:function(a){a=
"string"===typeof a?ig.global[a]:a;for(var b=[],c=0;c<this.entities.length;c++){var d=this.entities[c];d instanceof a&&!d._killed&&b.push(d)}return b},spawnEntity:function(a,b,c,d){var e="string"===typeof a?ig.global[a]:a;if(!e)throw"Can't spawn entity of type "+a;a=new e(b,c,d||{});this.entities.push(a);a.name&&(this.namedEntities[a.name]=a);return a},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(a){a.name&&
delete this.namedEntities[a.name];a._killed=!0;a.type=ig.Entity.TYPE.NONE;a.checkAgainst=ig.Entity.TYPE.NONE;a.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(a)},run:function(){this.update();this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null);if(this._doSortEntities||this.autoSort)this.sortEntities(),this._doSortEntities=!1;this.updateEntities();this.checkEntities();for(var a=0;a<this._deferredKill.length;a++)this.entities.erase(this._deferredKill[a]);
this._deferredKill=[];for(var b in this.backgroundAnims){var a=this.backgroundAnims[b],c;for(c in a)a[c].update()}},updateEntities:function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];b._killed||b.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor);this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var a;for(a=0;a<this.backgroundMaps.length;a++){var b=this.backgroundMaps[a];
if(b.foreground)break;b.setScreenPos(this.screen.x,this.screen.y);b.draw()}this.drawEntities();for(a;a<this.backgroundMaps.length;a++)b=this.backgroundMaps[a],b.setScreenPos(this.screen.x,this.screen.y),b.draw()},drawEntities:function(){for(var a=0;a<this.entities.length;a++)this.entities[a].draw()},checkEntities:function(){for(var a={},b=0;b<this.entities.length;b++){var c=this.entities[b];if(c.type!=ig.Entity.TYPE.NONE||c.checkAgainst!=ig.Entity.TYPE.NONE||c.collides!=ig.Entity.COLLIDES.NEVER)for(var d=
{},e=Math.floor(c.pos.y/this.cellSize),f=Math.floor((c.pos.x+c.size.x)/this.cellSize)+1,g=Math.floor((c.pos.y+c.size.y)/this.cellSize)+1,n=Math.floor(c.pos.x/this.cellSize);n<f;n++)for(var k=e;k<g;k++)if(a[n])if(a[n][k]){for(var h=a[n][k],m=0;m<h.length;m++)c.touches(h[m])&&!d[h[m].id]&&(d[h[m].id]=!0,ig.Entity.checkPair(c,h[m]));h.push(c)}else a[n][k]=[c];else a[n]={},a[n][k]=[c]}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex},POS_X:function(a,b){return a.pos.x+a.size.x-(b.pos.x+
b.size.x)},POS_Y:function(a,b){return a.pos.y+a.size.y-(b.pos.y+b.size.y)}}});ig.baked=!0;ig.module("game.defines.global").defines(function(){Tile={FLOOR:0,WALL:41};MapTile={GROUND2:42,EDGE_TOP:43,EDGE_RIGHT:44,EDGE_BOTTOM:45,EDGE_LEFT:46,CORNER_NW:47,CORNER_NE:48,CORNER_SW:49,CORNER_SE:50,SINGLE:61,SINGLE_H_START:62,SINGLE_H:63,SINGLE_H_END:64,SINGLE_V_START:65,SINGLE_V:66,SINGLE_V_END:67}});ig.baked=!0;
ig.module("game.classes.caveGenerator").requires("impact.impact","game.defines.global").defines(function(){Seed=100;CaveGenerator=ig.Class.extend({backgroundData:[],mapData:[],collisionData:[],board:{width:0,height:0},init:function(a){this.board={width:a.width,height:a.height};for(a=0;a<this.board.height;a++){this.backgroundData[a]=[];this.mapData[a]=[];this.collisionData[a]=[];for(var b=0;b<this.board.width;b++)this.backgroundData[a][b]=2,this.mapData[a][b]=0,this.collisionData[a][b]=0}this.generate();
this.arrangeTiles()},random:function(){var a=1700*Math.sin(Seed++);return a-Math.floor(a)},generate:function(){var a,b,c,d,e,f,g,n,k;for(a=0;a<this.board.height;a++)for(b=0;b<this.board.width;b++)this.mapData[a][b]=0==a||0==b||a==this.board.height-1||b==this.board.width-1?Tile.WALL:.6<Math.random()?Tile.WALL:Tile.FLOOR;for(a=0;7>a;a++){4>a?(f=5,g=2):(f=5,g=0);var h=[];for(c=0;c<this.board.height;c++)for(h[c]=[],b=0;b<this.board.width;b++)h[c][b]=Tile.WALL;for(c=1;c<this.board.height-1;c++)for(b=1;b<
this.board.width-1;b++){k=n=0;for(d=-1;1>=d;d++)for(e=-1;1>=e;e++)this.mapData[c+d][b+e]!=Tile.FLOOR&&n++;for(d=c-2;d<=c+2;d++)for(e=b-2;e<=b+2;e++)if(2!=Math.abs(d-c)||2!=Math.abs(e-b))0>d||0>e||d>=this.board.height||e>=this.board.width||this.mapData[d][e]!=Tile.FLOOR&&k++;h[c][b]=n>=f||k<=g?Tile.WALL:Tile.FLOOR}for(c=0;c<this.board.height;c++)for(b=0;b<this.board.width;b++)this.mapData[c][b]=h[c][b]}},arrangeTiles:function(){var a,b,c=[];for(a=0;a<this.board.height;a++)for(c[a]=[],b=0;b<this.board.width;b++)c[a][b]=
this.mapData[a][b];var d,e,f,g;for(a=0;a<this.board.height;a++)for(b=0;b<this.board.width;b++)this.mapData[a][b]==Tile.WALL&&(d=0<=a-1?this.mapData[a-1][b]==Tile.WALL:!0,e=b+1<this.board.width?this.mapData[a][b+1]==Tile.WALL:!0,f=a+1<this.board.height?this.mapData[a+1][b]==Tile.WALL:!0,g=0<=b-1?this.mapData[a][b-1]==Tile.WALL:!0,d&&e&&f&&g&&(c[a][b]=MapTile.GROUND2),d||e||f||g||(c[a][b]=MapTile.SINGLE),d&&e&&f&&!g&&(c[a][b]=MapTile.EDGE_LEFT),d&&!e&&f&&g&&(c[a][b]=MapTile.EDGE_RIGHT),!d&&e&&f&&g&&
(c[a][b]=MapTile.EDGE_TOP),d&&e&&!f&&g&&(c[a][b]=MapTile.EDGE_BOTTOM),!d&&!e&&f&&g&&(c[a][b]=MapTile.CORNER_NW),!d&&e&&f&&!g&&(c[a][b]=MapTile.CORNER_NE),d&&!e&&!f&&g&&(c[a][b]=MapTile.CORNER_SE),d&&e&&!f&&!g&&(c[a][b]=MapTile.CORNER_SW),d||!e||f||g||(c[a][b]=MapTile.SINGLE_H_START),d||e||f||!g||(c[a][b]=MapTile.SINGLE_H_END),d||e||!f||g||(c[a][b]=MapTile.SINGLE_V_START),!d||e||f||g||(c[a][b]=MapTile.SINGLE_V_END),d&&!e&&f&&!g&&(c[a][b]=MapTile.SINGLE_V),!d&&e&&!f&&g&&(c[a][b]=MapTile.SINGLE_H),this.collisionData[a][b]=
1);for(a=0;a<this.board.height;a++)for(b=0;b<this.board.width;b++)this.mapData[a][b]=c[a][b]}})});ig.baked=!0;
ig.module("game.levels.main").requires("impact.image").defines(function(){LevelMain={entities:[],layer:[{name:"background",width:60,height:50,linkWithCollision:!1,visible:!0,tilesetName:"cavegeneration/tiles.png",repeat:!1,preRender:!0,distance:"1",tilesize:24,foreground:!1,data:[]},{name:"map",width:60,height:50,linkWithCollision:!1,visible:!0,tilesetName:"cavegeneration/tiles.png",repeat:!1,preRender:!1,distance:"1",tilesize:24,foreground:!1,data:[]},{name:"collision",width:60,height:50,linkWithCollision:!1,visible:!0,
tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:24,foreground:!1,data:[]}]};LevelMainResources=[new ig.Image("cavegeneration/tiles.png"),new ig.Image("cavegeneration/tiles.png")]});ig.baked=!0;
ig.module("game.entities.player").requires("impact.entity").defines(function(){EntityPlayer=ig.Entity.extend({size:{x:24,y:24},collides:ig.Entity.COLLIDES.ACTIVE,animSheet:new ig.AnimationSheet("cavegeneration/players.png",24,24),targetPos:{x:0,y:0},step:12,speed:{x:0,y:0},inputTimer:void 0,isHolding:!1,isWaiting:!0,isMoving:!1,points:[],init:function(a,b,c){this.parent(a,b,c);this.initPoints();this.vel.x=0;this.vel.y=0;this.addAnim("idle",.5,[0,1]);this.inputTimer=new ig.Timer(.2)},faceFlip:function(a){this.currentAnim.flip.x=
a},update:function(){if(this.isMoving)this.moveToTarget();else{this.isHolding=0>=this.inputTimer.delta();if(!this.isHolding){var a=!1;if(ig.input.state("left"))this.setTarget(4),a=!0;else if(ig.input.state("right"))this.setTarget(2),a=!0;else if(ig.input.state("up"))this.setTarget(1),a=!0;else if(ig.input.state("down"))this.setTarget(3),a=!0;else if(ig.input.state("mouse1")){for(var b=0,c=0;4>c;c++){var d=this.points[c];if(this.isInsideTriangle(d[0],d[1],d[2],ig.input.mouse)){b=c+1;break}}0!=b&&(this.setTarget(b),
a=!0)}a&&(this.inputTimer.reset(),ig.game.checkCollision(this.targetPos.x,this.targetPos.y)||(this.isMoving=this.isHolding=!0,this.speed.x=(this.targetPos.x-this.pos.x)/this.step,this.speed.y=(this.targetPos.y-this.pos.y)/this.step,this.moveToTarget()))}this.parent()}},setTarget:function(a){switch(a){case 1:this.targetPos={x:this.pos.x,y:this.pos.y-this.size.y};break;case 2:this.faceFlip(!0);this.targetPos=this.pos.x+this.size.x<ig.game.collisionMap.width*this.size.x?{x:this.pos.x+this.size.x,y:this.pos.y}:
{x:-1,y:-1};break;case 3:this.targetPos={x:this.pos.x,y:this.pos.y+this.size.y};break;case 4:this.faceFlip(!1),this.targetPos=0<=this.pos.x-this.size.x?{x:this.pos.x-this.size.x,y:this.pos.y}:{x:-1,y:-1}}},moveToTarget:function(){this.pos.x+=this.speed.x;this.pos.y+=this.speed.y;Math.round(this.pos.x)==this.targetPos.x&&Math.round(this.pos.y)==this.targetPos.y&&(this.isMoving=!1,this.targetPos={x:-1,y:-1})},initPoints:function(){var a={x:0,y:0},b={x:ig.system.width,y:0},c={x:ig.system.width,y:ig.system.height},
d={x:0,y:ig.system.height},e,f={x:ig.system.width/2,y:ig.system.height/2};e=[];e.push(f);e.push(a);e.push(b);this.points.push(e);e=[];e.push(f);e.push(b);e.push(c);this.points.push(e);e=[];e.push(f);e.push(d);e.push(c);this.points.push(e);e=[];e.push(f);e.push(a);e.push(d);this.points.push(e)},sign:function(a){return Math.abs(a)/a},isInsideTriangle:function(a,b,c,d){var e=(b.x-d.x)*(c.y-d.y)-(c.x-d.x)*(b.y-d.y);c=(c.x-d.x)*(a.y-d.y)-(a.x-d.x)*(c.y-d.y);return this.sign((a.x-d.x)*(b.y-d.y)-(b.x-d.x)*
(a.y-d.y))==this.sign(e)&&this.sign(e)==this.sign(c)}})});ig.baked=!0;
ig.module("game.main").requires("impact.game","impact.font","game.classes.caveGenerator","game.levels.main","game.entities.player").defines(function(){MyGame=ig.Game.extend({gravity:0,board:{width:0,height:0},tileSize:0,player:void 0,caveGenerator:void 0,font:new ig.Font("cavegeneration/04b03.font.png"),statText:new ig.Font("cavegeneration/04b03.font.png"),levelTimer:new ig.Timer,levelExit:null,init:function(){ig.input.bind(ig.KEY.LEFT_ARROW,"left");ig.input.bind(ig.KEY.RIGHT_ARROW,"right");ig.input.bind(ig.KEY.UP_ARROW,
"up");ig.input.bind(ig.KEY.DOWN_ARROW,"down");ig.input.bind(ig.KEY.MOUSE1,"mouse1");this.caveGenerator=new CaveGenerator({width:60,height:50});LevelMain.layer[0].data=this.caveGenerator.backgroundData;LevelMain.layer[1].data=this.caveGenerator.mapData;LevelMain.layer[2].data=this.caveGenerator.collisionData;this.loadLevel(LevelMain);this.board={width:ig.game.collisionMap.width,height:ig.game.collisionMap.height};this.tileSize=ig.game.collisionMap.tilesize;var a={x:24,y:29};1==ig.game.collisionMap.data[a.x][a.y]&&
(console.log("Trapped Player!"),a=this.findAnotherLocation(a.x));this.player=ig.game.spawnEntity(EntityPlayer,a.y*this.tileSize,a.x*this.tileSize,{})},update:function(){this.parent()},draw:function(){this.player&&(this.screen.x=this.player.pos.x-ig.system.width/2+this.tileSize/2,this.screen.y=this.player.pos.y-ig.system.height/2+this.tileSize/2);this.parent()},checkCollision:function(a,b){return-1==a&&-1==b?1:this.collisionMap.data[Math.floor(b/this.tileSize)][Math.floor(a/this.tileSize)]},findAnotherLocation:function(a){var b;
for(b=a+1;b<this.board.height;b++)if(0==ig.game.collisionMap.data[b][a])return{x:b,y:a};for(b=a-1;0<b;b--)if(0==ig.game.collisionMap.data[b][a])return{x:b,y:a}}});ig.ua.mobile&&(ig.Sound.enabled=!1);ig.main("#canvas",MyGame,60,640,480,1)});